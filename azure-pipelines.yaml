trigger:
  - master

variables:
  buildPlatform: 'AnyCPU' # specify platform ('x86', 'x64', 'AnyCPU')
  testAssembliesSearchPattern: 'BuildTest\**\*Test.dll'
  
jobs:
- job: 'CI'
  displayName: 'CI'
  pool:
    name: Hosted VS2017
    
  strategy:
    matrix:
      Debug:
        buildConfiguration: 'Debug'
      Release:
        buildConfiguration: 'Release'
        
  steps:
  - task: DotNetCoreCLI@2
    displayName: Restore
    inputs:
      command: 'restore'
      projects: '**/*.csproj'

  - task: DotNetCoreCLI@2
    displayName: Build
    inputs:
      command: build
      projects: '**/*.csproj'
      arguments: '--configuration $(buildConfiguration) /p:Platform $(buildPlatform)'

  - task: DotNetCoreCLI@2
    displayName: Test
    inputs:
      command: test
      projects: '$(testAssembliesSearchPattern)'
      arguments: '--configuration $(buildConfiguration) /p:Platform $(buildPlatform)'

  - task: DotNetCoreCLI@2
    displayName: 'dotnet pack'
    inputs:
      command: pack
      packagesToPack: '**/*.csproj;-:**/*.Test.csproj'

  #- task: NuGetCommand@2
  #  displayName: 'NuGet push'
  #  inputs:
  #    command: push
  #    packagesToPush: '$(Build.ArtifactStagingDirectory)/*.nupkg'
  #    nuGetFeedType: external
  #    publishFeedCredentials: 'nuget/mdabros Api'
  #  enabled: false
  #  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
